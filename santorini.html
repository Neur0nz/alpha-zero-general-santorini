<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.3/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.16.0/dist/ort.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <script src="./santorini/constants_nogod.js"></script>
  <script src="./common/game.js"></script>
  <script src="./santorini/main.js"></script>
  <style>
    .ui.table tbody tr td.selectable {
      background-color: #f3f8ff;
    }

    .ui.table tbody tr td.selectable:hover {
      background-color: #e8f1ff;
    }
  </style>
</head>
<body>

<div class="ui borderless menu">
  <div class="ui container">    
    <div class="fitted item">
      <button class="ui icon button" onclick="reset()"><i class="file outline icon"></i></button>
    </div> 
    <div class="fitted item"> 
      <button class="ui icon button" onclick="edit()" id="editBtn"><i class="edit icon"></i></button>
    </div> 
    <div class="fitted item"> 
      <div class="ui small form">
        <div class="field">
          <select onchange="game.change_difficulty(this.value)" id="difficultyForm">
            <optgroup label="Above optimal">
            <option value="12800"       >God-like</option>
            <option value="3200"       >Boosted</option>
            <optgroup label="Level used during training">
            <option value="800"        >Native</option>
            <optgroup label="Sub optimal levels">
            <option value="200"        >Medium</option>
            <option value="50" selected>Easy</option>
            <option value="12"         >Easier</option>
            <option value="3"          >Come on</option>
          </select>
        </div>
      </div>
    </div>
    <div class="fitted item"> 
      <div class="ui small form">
        <div class="field">
          <select onchange="changeGameMode(this.value)">
            <option value="P0" selected>You vs AI</option>
            <option value="P1"         >AI vs you</option>
            <option value="Human"      >No AI</option>
            <option value="AI"         >WarGames</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="ui main container">

  <h1 class="ui huge center aligned header">Santorini (no gods)</h1> 
  <div class="ui hidden divider"></div>


<!-- Players name and power -->


  <div class="ui horizontal basic segments">
    <div class="ui center aligned vertically fitted segment">
      <span class="ui large green text" id="p0title">You</span>
      <p id="p0details">Classic rules: click highlighted cells to move and build.</p>
    </div>
    <div class="ui center aligned vertically fitted segment">
      <span class="ui large red text" id="p1title">AI</span>
      <p id="p1details">Monte Carlo tree search opponent trained for the no-god variant.</p>
    </div>
  </div>


  <!-- Evaluation Display -->
  <div id="evalContainer" x-data="evalBarData()" x-init="window.evalBar = $el">
    <div class="ui segment" style="background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); padding: 12px; margin-top: 10px;">
      <!-- Header with Calc button -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <div style="flex: 1;"></div>
        <div style="text-align: center; font-weight: bold; font-size: 14px; color: #333;">ü§ñ AI EVALUATION</div>
        <div style="flex: 1; text-align: right;">
          <button 
            class="ui mini compact button" 
            @click="recalculate()" 
            :class="{ 'loading': calculating }"
            :disabled="calculating"
            title="Recalculate evaluation for current position">
            üîÑ Calc
          </button>
        </div>
      </div>
      
      <!-- Labels -->
      <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; padding: 0 20px; color: #666;">
        <span style="color: #DB2828;">‚Üê Red (Player 1)</span>
        <span style="color: #21BA45;">Green (Player 0) ‚Üí</span>
      </div>
      
      <!-- Evaluation Bar -->
      <div style="position: relative; width: 400px; height: 24px; border: 2px solid #333; border-radius: 4px; margin: 8px auto; background: #f0f0f0;">
        <!-- Center line marker -->
        <div style="position: absolute; left: 50%; top: 0; width: 2px; height: 100%; background: #666; transform: translateX(-1px);"></div>
        
        <!-- Colored bar expanding from center -->
        <template x-if="value > 0">
          <div 
            :style="`position: absolute; left: 50%; top: 0; width: ${barWidth}px; height: 100%; background: ${barColor}; transition: width 0.3s ease;`">
          </div>
        </template>
        <template x-if="value < 0">
          <div 
            :style="`position: absolute; right: 50%; top: 0; width: ${barWidth}px; height: 100%; background: ${barColor}; transition: width 0.3s ease;`">
          </div>
        </template>
      </div>
      
      <!-- Numeric value and description -->
      <div style="text-align: center; font-size: 13px; margin-top: 4px;">
        <span style="font-weight: bold; font-size: 16px;" x-text="evalText"></span>
        <span style="color: #666; margin-left: 8px;" x-text="'(' + advantage + ')'"></span>
      </div>
    </div>
  </div>

  <!-- Table -->

  
  <table class="ui fixed unstackable celled huge compact table"><tbody>
    <tr class="center aligned">
      <td class="" id="cell_0_0"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_0_1"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_0_2"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_0_3"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_0_4"><div class="ui middle aligned tiny image"></div></td>
    </tr>
    <tr class="center aligned">
      <td class="" id="cell_1_0"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_1_1"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_1_2"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_1_3"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_1_4"><div class="ui middle aligned tiny image"></div></td>
    </tr>
    <tr class="center aligned">
      <td class="" id="cell_2_0"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_2_1"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_2_2"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_2_3"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_2_4"><div class="ui middle aligned tiny image"></div></td>
    </tr>
    <tr class="center aligned">
      <td class="" id="cell_3_0"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_3_1"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_3_2"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_3_3"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_3_4"><div class="ui middle aligned tiny image"></div></td>
    </tr>
    <tr class="center aligned">
      <td class="" id="cell_4_0"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_4_1"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_4_2"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_4_3"><div class="ui middle aligned tiny image"></div></td>
      <td class="" id="cell_4_4"><div class="ui middle aligned tiny image"></div></td>
    </tr>
  </tbody></table>


<!-- Button -->


  <div class="ui fluid large compact buttons" id="allBtn" style="display: none">
    <button class="ui icon button" id="undoBtn" onclick="cancel_and_undo()"><i class="undo icon"></i></button>
  </div>
  <button class="ui fluid large active loading button" id="loadingBtn">‚Äå</button>
  <div class="ui hidden info message" id="editMsg">
    <div class="header">Info for editing</div>
    <p>Tap on cells to change their heights, tap again on edit to toggle workers, then tap edit once more to validate.</p>
  </div>

  <div class="ui basic segment">
    <p id="moveSgmt">Loading pyodide, numpy, onnx; please wait...</p>
  </div>
</div>


<script>
  const allBtn      = document.getElementById('allBtn');
  const undoBtn     = document.getElementById('undoBtn');
  const loadingBtn  = document.getElementById('loadingBtn');
  const editBtn     = document.getElementById('editBtn');
  const moveSgmt    = document.getElementById('moveSgmt');
  const p0title     = document.getElementById('p0title');
  const p0details   = document.getElementById('p0details');
  const p1title     = document.getElementById('p1title');
  const p1details   = document.getElementById('p1details');
  const editMsg     = document.getElementById('editMsg');

  const counterAPI_base = 'https://abacus.jasoncameron.dev/hit/cestpasphoto.github.io';
  const counterAPI_suffix = new Date().toISOString().slice(2,7).replace('-','');
  window.onload = () =>
    [ `${counterAPI_base}/overall`, `${counterAPI_base}/overall_${counterAPI_suffix}`,`${counterAPI_base}/santorini_${counterAPI_suffix}`]
    .forEach(u => fetch(u).catch(() => {}));

  main(usePyodide=true);
</script>
<script>

</script>
</body>
</html>
